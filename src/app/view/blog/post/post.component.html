<div *ngIf="!isPage">
  <app-modules-not-found></app-modules-not-found>
</div>
<div *ngIf="isPage">
  <div *ngIf="isLoading">
    <app-modules-page-loading style="color:'white'"></app-modules-page-loading>
  </div>  
  <app-blog-left-sidebar
    [isEditingPost]="isEditingPost"
    [isEditingCategory]="isEditingCategory"
    [categoryContents]="categoryContents"
    [categoryContentsForm]="categoryContentsForm"
    [blogContents]="blogContents"
    [postImageContents]="postImageContents"
    (clickStartUploadPostImageSrc)="handleClickStartUploadPostImageSrc()"
    (clickRemovePostImage)="handleClickRemovePostImage($event)"
  ></app-blog-left-sidebar>
  <div class="blog-post">
    <form *ngIf="postContentsForm" [formGroup]="postContentsForm">
      <section class="post-section">
        <div *ngIf="isCreatingPost">
          <Button
            class="btn btn-sm btn-outline-light me-2"
            *ngIf="authService.isSignedIn() && isEditingPost"
            (click)="handleClickEditPostCreateUpdate()"
          >Update</Button>
          <Button
            class="btn btn-sm btn-outline-light me-2"
            *ngIf="authService.isSignedIn() && isEditingPost"
            (click)="handleClickEditPostCreateCancel()"
          >Cancel</Button>
        </div>

        <div *ngIf="!isCreatingPost" class="row">
          <div class="col-6">
            <Button
              class="btn btn-sm btn-warning me-2"
              *ngIf="authService.isSignedIn() && !isEditingPost"
              (click)="clickPostEdit()"
            >Edit Post</Button>
            <Button
              class="btn btn-sm btn-outline-light me-2"
              *ngIf="authService.isSignedIn() && isEditingPost"
              (click)="handleClickEditPostUpdate()"
            >Update</Button>
            <Button
              class="btn btn-sm btn-outline-light me-2"
              *ngIf="authService.isSignedIn() && isEditingPost"
              (click)="handleClickEditPostDelete()"
            >Remove</Button>
            <Button
              class="btn btn-sm btn-outline-light me-2"
              *ngIf="authService.isSignedIn() && isEditingPost"
              (click)="clickPostEditCancel()"
            >Cancel</Button>
          </div>
          <div class="col-6 d-flex">
            <Button
              class="btn btn-sm btn-warning ms-auto"
              *ngIf="authService.isSignedIn() && !isEditingPost"
              (click)="routerHelper.goToBlogCategoryNewPost(params,postContentsForm.value.categoryId)"
            >Create New Post</Button>
          </div>
        </div>
        <div *ngIf="!isEditingPost">
          <div class="row">
            <div class="col-9">
              <span
                class="post-show-title-col blog-link"
                (click)="routerHelper.goToBlogPost(params,postContentsForm.controls.id.value)"
              >
                {{postContentsForm.controls.postTitle.value}}
              </span>
              <span>| </span>
              <span
                class="post-show-title-category-col blog-link"
                style="font-size: 0.8rem;"
                (click)="routerHelper.goToBlogCategory(params,postContentsForm.controls.categoryId.value)"
              >{{getCategoryTitle(postContentsForm.controls.categoryId.value)}}</span>
            </div>
            <div class="col-3">
              <div class="post-show-title-date">
                {{dataTransferHelper.numberToDateString(postContentsForm.controls.createdAt.value)}}
              </div>
            </div>
          </div>
          <div class="form-row">
            <div class="col-12 post-edit-content-col">
              <markdown
                emoji
                lineNumbers
                ngPreserveWhitespaces
                data={{dataTransferHelper.markDownPreprocess(postContentsForm.controls.postMarkdown.value)}}
              >
              </markdown>
            </div>
          </div>
        </div>
      </section>

      <section class="post-editing-section">
        <div
          *ngIf="hasNullPostTitleError"
          class="post-edit-title-col-null-error mt-3"
        >Please Insert Title</div>
        <div class="d-flex flex-wrap" *ngIf="isEditingPost">
          <div class="post-edit-col">
            <input
              type="text"
              class="form-control post-editarea"
              formControlName="postTitle"
              placeholder="Title"
            />
            <textarea
              id="postTextArea"
              #postTextArea
              class="form-control post-editarea"
              rows="{{getPostMarkdownLines()}}"
              formControlName="postMarkdown"
              placeholder="Content"
            ></textarea>
          </div>

          <div class="post-edit-preview-col">
            <div
              class="post-edit-title-col post-link"
            >{{postContentsForm.controls.postTitle.value}}</div>

            <div class="post-edit-content-col">
              <markdown
                emoji
                lineNumbers
                ngPreserveWhitespaces
                data={{dataTransferHelper.markDownPreprocess(postContentsForm.controls.postMarkdown.value)}}
              >
              </markdown>
            </div>
          </div>
        </div>
      </section>
    </form>
  </div>
  <app-comment
    *ngIf="params?.postId"
    [isEditingPost]="isEditingPost"
    [blogContents]="blogContents"
  ></app-comment>
</div>
